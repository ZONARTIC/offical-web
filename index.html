<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- âœ… THÃŠM DÃ’NG NÃ€Y - CSP chá»‘ng XSS -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://script.google.com;">
  
  <title>Zonartic Games - Mobile Game Publisher</title>
  <meta name="description" content="Discover amazing mobile games from Zonartic Games">
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="header-container">
      <div class="logo" onclick="window.location.href='index.html'">
        <img src="images/logo.png" alt="Zonartic Logo" />
      </div>
      
      <button class="menu-toggle" onclick="toggleMenu(event)" aria-label="Toggle menu" aria-expanded="false">â˜°</button>
      
      <div class="nav-wrapper">
        <nav class="nav-menu">
          <ul>
            <li><a href="index.html"class="active" >HOME</a></li>
            <li><a href="blog.html">BLOG</a></li>
            <li><a href="mobile-games.html">MOBILE GAMES</a></li>
            <li><a href="test-games.html">TEST GAMES</a></li>
            <li><a href="about.html">ABOUT US</a></li>
            <li><a href="contact.html">CONTACT US</a></li>
          </ul>
          <div class="social-icons">
            <a href="https://www.facebook.com/profile.php?id=61584723680310" target="_blank" rel="noopener noreferrer">
              <img src="images/facebook.png" alt="Facebook" />
            </a>
            <a href="https://www.instagram.com/zonartic_studio?igsh=NXpvcDB6cHA1eWFw" target="_blank" rel="noopener noreferrer">
              <img src="images/instagram.png" alt="Instagram" />
            </a>
            <a href="https://x.com/Zonartic_Studio" target="_blank" rel="noopener noreferrer">
              <img src="images/twitter.png" alt="Twitter" />
            </a>
            <a href="https://youtube.com" target="_blank" rel="noopener noreferrer">
              <img src="images/youtube.png" alt="YouTube" />
            </a>
          </div>
        </nav>
      </div>
    </div>
  </header>
  
  <!-- MAIN CONTENT -->
  <main>
    <section class="explore">
      <h2>Explore New Games</h2>
      
      <!-- Search Bar -->
      <div class="search-container">
        <div class="search-wrapper">
          <input 
            type="text" 
            id="game-search" 
            class="search-input" 
            placeholder="Search for games..."
            autocomplete="off"
          />
          <button class="search-button" aria-label="Search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div id="search-results" class="search-results hidden"></div>
      </div>
      
      <!-- GOOGLE GROUP PANEL WITH EMAIL INVITATION -->
      <div class="group-panel">
        <div class="group-panel-content">
          <h3>
            <span class="group-icon">ğŸ‘¥</span>
            Tham Gia NhÃ³m Test Game
          </h3>
          <p>Trá»Ÿ thÃ nh ngÆ°á»i Ä‘áº§u tiÃªn tráº£i nghiá»‡m cÃ¡c game má»›i! Nháº­p email vÃ  chÃºng tÃ´i sáº½ gá»­i lá»i má»i tham gia nhÃ³m cho báº¡n.</p>
          
          <div class="group-notice">
            <strong>âš ï¸ LÆ¯U Ã HÆ¯á»šNG DáºªN THAM GIA:</strong>
            <ul>
              <li>#Chá»‰ Ä‘Äƒng kÃ½ má»™t láº§n duy nháº¥t Ä‘á»ƒ táº£i táº¥t cáº£ cÃ¡c game</li>
              <li>BÆ°á»›c 1: Kiá»ƒm tra Email Ä‘Äƒng kÃ½ = Email CH play </li>
              <li>BÆ°á»›c 2: Kiá»ƒm tra Email Ä‘Äƒng kÃ½ = Email hiá»‡n cÃ³ trong trÃ¬nh duyá»‡t </li>
              <li>BÆ°á»›c 3: Nháº­p Email Ä‘Ã£ chá»n vÃ o khung Ä‘Äƒng kÃ½</li>
              <li>BÆ°á»›c 4: Kiá»ƒm tra thÆ° trong Gmail vÃ  nháº¥n xÃ¡c nháº­n tham gia.</li>
              <li>BÆ°á»›c 5: Vui lÃ²ng lÃ m theo hÆ°á»›ng dáº«n cá»§a Google vÃ  Ä‘á»£i xá»­ lÃ½ thÃ´ng tin trong vÃ i phÃºt.</li>
            </ul>
          </div>
          
          <div class="group-form">
            <div class="form-group">
              <label for="user-email">Email cá»§a báº¡n (Gmail) *</label>
              <input 
                type="email" 
                id="user-email" 
                placeholder="example@gmail.com" 
                required
              />
            </div>
            
            <div class="form-group">
              <label for="user-name">TÃªn cá»§a báº¡n (khÃ´ng báº¯t buá»™c)</label>
              <input 
                type="text" 
                id="user-name" 
                placeholder="TÃªn cá»§a báº¡n" 
              />
            </div>
            
            <button class="join-button" id="joinButton" onclick="joinGroupWithAPI()">
              ğŸ“§ Gá»­i YÃªu Cáº§u Tham Gia
            </button>
            
            <div id="success-message" class="success-message"></div>
            <div id="error-message" class="error-message"></div>
            
          </div>
        </div>
      </div>
      
       <!-- Download Games Section Title -->
<div class="download-games-title">
  <div class="title-line"></div>
  <h3>Táº¢I GAME BÃŠN DÆ¯á»šI</h3>
  <div class="title-line"></div>
</div>
      
      <!-- Games Container -->
      <div id="games-container">
        <div class="game-card">
          <div class="game-icon">
            <img src="images/game-icon.png" alt="Game Icon" />
          </div>
          <div class="game-info">
            <h3>Game Title</h3>
            <p>Game description will appear here. Add games in games.json file.</p>
            <div class="download-buttons">
              <a href="#" onclick="alert('Add game link in games.json'); return false;">
                GET IT ON Google Play
              </a>
            </div>
          </div>
          <div class="game-promo">
            <img src="images/game-promo.jpg" alt="Game Promo" />
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 Zonartic Games. All rights reserved.</p>
    <div class="footer-links">
      <a href="terms.html">Äiá»u Khoáº£n Sá»­ Dá»¥ng</a>
      <span>|</span>
      <a href="privacy.html">ChÃ­nh SÃ¡ch Báº£o Máº­t</a>
    </div>
  </div>
  </footer>
  <!-- Scroll Down Arrow -->
  <div class="scroll-arrow" onclick="document.getElementById('games-container').scrollIntoView({behavior: 'smooth'})">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 5v14M19 12l-7 7-7-7"/>
    </svg>
  </div>
  
  
  
  <!-- Floating Contact Button -->
  <a href="contact.html" class="floating-contact" aria-label="Contact Us">
    <img src="images/contact-icon.png" alt="Contact" />
  </a>
  
  <!-- JavaScript -->
  <script>
    // XSS PREVENTION - Sanitize Input
    // ==========================================
    function sanitizeInput(input) {
      if (!input) return '';
      
      return input
        .toString()
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#x27;')
        .replace(/\//g, '&#x2F;');
    }

    
    // ==========================================
    // PROTECTED API CONFIGURATION
    // ==========================================
    function getAPI() {
      const parts = [
        'aHR0cHM6Ly9zY3JpcHQuZ29vZw',
        'bGUuY29tL21hY3Jvcy9zL0FLZg',
        'eWNieWNRZW0xbmctUlVXWktHSA',
        'NWo0ZVZ4RnpQTmRyQXUyT05ndQ',
        'YzgxeHY2TkxGUWlOc1F3OVBxSA',
        'c0MwakhjOXdUQTBpL2V4ZWM'
      ];
      let url = '';
      for (let i = 0; i < parts.length; i++) {
        url += atob(parts[i]);
      }
      return url;
    }
    const API_ENDPOINT = getAPI();
    
    // ==========================================
    // Mobile Menu Toggle
    // ==========================================
    function toggleMenu(event) {
      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      setTimeout(function() {
        const navWrapper = document.querySelector('.nav-wrapper');
        const menuToggle = document.querySelector('.menu-toggle');
        
        if (!navWrapper || !menuToggle) return;
        
        navWrapper.classList.toggle('show');
        
        if (navWrapper.classList.contains('show')) {
          menuToggle.innerHTML = 'âœ•';
          menuToggle.setAttribute('aria-expanded', 'true');
        } else {
          menuToggle.innerHTML = 'â˜°';
          menuToggle.setAttribute('aria-expanded', 'false');
        }
      }, 50);
    }
    
    document.addEventListener('click', function(event) {
      if (window.innerWidth <= 768) {
        setTimeout(function() {
          const navWrapper = document.querySelector('.nav-wrapper');
          const menuToggle = document.querySelector('.menu-toggle');
          const header = document.querySelector('header');
          
          if (!navWrapper || !menuToggle || !header) return;
          
          if (!header.contains(event.target) && navWrapper.classList.contains('show')) {
            navWrapper.classList.remove('show');
            menuToggle.innerHTML = 'â˜°';
            menuToggle.setAttribute('aria-expanded', 'false');
          }
        }, 50);
      }
    });
    
    document.addEventListener('DOMContentLoaded', function() {
      document.body.addEventListener('click', function(event) {
        if (window.innerWidth <= 768) {
          const target = event.target.closest('.nav-menu a');
          
          if (target) {
            setTimeout(function() {
              const navWrapper = document.querySelector('.nav-wrapper');
              const menuToggle = document.querySelector('.menu-toggle');
              
              if (!navWrapper || !menuToggle) return;
              
              navWrapper.classList.remove('show');
              menuToggle.innerHTML = 'â˜°';
              menuToggle.setAttribute('aria-expanded', 'false');
            }, 100);
          }
        }
      });
    });
    
    let resizeTimer;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(function() {
        const navWrapper = document.querySelector('.nav-wrapper');
        const menuToggle = document.querySelector('.menu-toggle');
        
        if (!navWrapper || !menuToggle) return;
        
        if (window.innerWidth > 768) {
          navWrapper.classList.remove('show');
          menuToggle.innerHTML = 'â˜°';
          menuToggle.setAttribute('aria-expanded', 'false');
        }
      }, 100);
    });
    
    if (typeof MutationObserver !== 'undefined') {
      const observer = new MutationObserver(function(mutations) {
        const menuToggle = document.querySelector('.menu-toggle');
        if (menuToggle && !menuToggle.hasAttribute('data-listener-attached')) {
          menuToggle.setAttribute('data-listener-attached', 'true');
        }
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
    
    // ==========================================
    // SEND GROUP INVITATION VIA EMAIL
    // ==========================================
    async function joinGroupWithAPI() {
      const emailInput = document.getElementById('user-email');
      const nameInput = document.getElementById('user-name');
      const joinButton = document.getElementById('joinButton');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      
      const email = sanitizeInput(emailInput.value.trim());
      const name = sanitizeInput(nameInput.value.trim()) || 'Guest';
      
      // Hide previous messages
      successMessage.classList.remove('show');
      errorMessage.classList.remove('show');
      successMessage.textContent = '';
      errorMessage.textContent = '';
      
      // Validate email
      if (!email) {
        showError('âš ï¸ Vui lÃ²ng nháº­p email cá»§a báº¡n!');
        emailInput.focus();
        return;
      }
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showError('âš ï¸ Email khÃ´ng há»£p lá»‡! Vui lÃ²ng nháº­p Ä‘Ãºng Ä‘á»‹nh dáº¡ng.');
        emailInput.focus();
        return;
      }
      
      // Check if Gmail (warning only)
      if (!email.toLowerCase().endsWith('@gmail.com')) {
        const confirmNonGmail = confirm(
          'âš ï¸ Khuyáº¿n nghá»‹ sá»­ dá»¥ng Gmail Ä‘á»ƒ dá»… join group vÃ  test game.\n\n' +
          'Email khÃ´ng pháº£i Gmail. Báº¡n cÃ³ muá»‘n tiáº¿p tá»¥c?'
        );
        if (!confirmNonGmail) return;
      }
      
      // Show loading
      joinButton.disabled = true;
      joinButton.textContent = 'â³ Äang gá»­i email...';
      
// --- Báº®T Äáº¦U KHá»I THAY THáº¾ ---
Â  Â  Â  try {
Â  Â  Â  Â  console.log('Sending invitation to:', email);
        
        // 1. Táº¡o chuá»—i Query String
        const queryStringBody = `email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}`;
        
Â  Â  Â  Â  const response = await fetch(API_ENDPOINT, {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  // 2. Giá»¯ nguyÃªn text/plain (hoáº·c báº¡n cÃ³ thá»ƒ dÃ¹ng text/plain;charset=utf-8)
Â  Â  Â  Â  Â  Â  'Content-Type': 'text/plain', 
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  // 3. GÃ¡n chuá»—i Query String vÃ o body
Â  Â  Â  Â  Â  body: queryStringBody
Â  Â  Â  Â  });
// --- Káº¾T THÃšC KHá»I THAY THáº¾ ---
        
        const result = await response.json();
        console.log('API Response:', result);
        
        if (result.success) {
          // Mask email for display (show first 3 chars + *** + domain)
          const maskedEmail = maskEmail(email);
          
          showSuccess(
            `âœ… ÄÃ£ gá»­i yÃªu cáº§u tham gia thÃ nh cÃ´ng!\n\n` +
            `ğŸ“§ Email má»i Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n: ${maskedEmail}\n\n` +
            `Vui lÃ²ng kiá»ƒm tra há»™p thÆ° vÃ  lÃ m theo hÆ°á»›ng dáº«n Ä‘á»ƒ hoÃ n táº¥t viá»‡c tham gia nhÃ³m.`
          );
          
          // Clear form
          emailInput.value = '';
          nameInput.value = '';
          
        } else {
          showError(`âŒ Lá»—i: ${result.message || 'KhÃ´ng thá»ƒ gá»­i email'}`);
        }
        
      } catch (error) {
        console.error('Error:', error);
        showError(
          'Há»‡ thá»‘ng Ä‘ang load láº¡i, vui lÃ²ng thá»­ láº¡i sau vÃ i giÃ¢y'
          
        );
      } finally {
        joinButton.disabled = false;
        joinButton.textContent = 'ğŸ“§ Gá»­i YÃªu Cáº§u Tham Gia';
      }
    }
    
    // ==========================================
    // HELPER FUNCTIONS
    // ==========================================
    function maskEmail(email) {
      const [localPart, domain] = email.split('@');
      if (localPart.length <= 3) {
        return localPart.charAt(0) + '***@' + domain;
      }
      return localPart.substring(0, 3) + '***@' + domain;
    }
    
    function showSuccess(message) {
      const successMessage = document.getElementById('success-message');
      successMessage.textContent = message;
      successMessage.classList.add('show');
      
      // Scroll to message
      successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      // Hide after 15 seconds
      setTimeout(() => {
        successMessage.classList.remove('show');
      }, 15000);
    }
    
    function showError(message) {
      const errorMessage = document.getElementById('error-message');
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
      
      // Scroll to message
      errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      // Hide after 10 seconds
      setTimeout(() => {
        errorMessage.classList.remove('show');
      }, 10000);
    }
    
    // Enter key to submit
    document.getElementById('user-email').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        joinGroupWithAPI();
      }
    });
    
    document.getElementById('user-name').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        joinGroupWithAPI();
      }
    });
    // ==========================================
    // SCROLL ARROW VISIBILITY - THÃŠM VÃ€O ÄÃ‚Y
    // ==========================================
    window.addEventListener('scroll', function() {
      const scrollArrow = document.querySelector('.scroll-arrow');
      const footer = document.querySelector('footer');
      
      if (!scrollArrow || !footer) return;
      
      const footerTop = footer.getBoundingClientRect().top;
      const windowHeight = window.innerHeight;
      
      // áº¨n mÅ©i tÃªn khi footer xuáº¥t hiá»‡n trÃªn mÃ n hÃ¬nh
      if (footerTop <= windowHeight) {
        scrollArrow.classList.add('hidden');
      } else {
        scrollArrow.classList.remove('hidden');
      }
    });
    
    // ==========================================
    // LOAD GAMES FROM JSON - Vá»šI LOAD MORE
    // ==========================================
    let gamesData = [];
    let currentPage = 1;
    const gamesPerPage = 10; // Sá»‘ games hiá»ƒn thá»‹ má»—i láº§n

    async function loadGames() {
      try {
        const response = await fetch('data/games.json');
        const allGames = await response.json();
        
        // Lá»c games Ä‘Ã£ published vÃ  lÃ  test games
        gamesData = allGames.filter(game =>  game.isTest);
        
        // Reset vá» trang 1
        currentPage = 1;
        renderGames();
      } catch (error) {
        console.log('Could not load games:', error);
      }
    }

    function renderGames() {
      const container = document.getElementById('games-container');
      if (!container) return;
      
      if (gamesData.length === 0) {
        container.innerHTML = '<p style="text-align:center;color:#666;padding:40px;">ChÆ°a cÃ³ game nÃ o.</p>';
        return;
      }
      
      // Láº¥y sá»‘ games cáº§n hiá»ƒn thá»‹
      const gamesToShow = gamesData.slice(0, currentPage * gamesPerPage);
      
      // Render game cards
      let html = gamesToShow.map(game => `
        <div class="game-card" id="${game.id}">
          <div class="game-icon">
            <img src="${game.icon}" alt="${game.name} Icon" loading="lazy" />
          </div>
          <div class="game-info">
            <h3>${game.name}</h3>
            <p>${game.description}</p>
            <div class="download-buttons">
              <a href="${game.testLink}" target="_blank" rel="noopener noreferrer">
                GET IT ON Google Play
              </a>
            </div>
          </div>
          <div class="game-promo">
            <img src="${game.promo}" alt="${game.name} Promo" loading="lazy" />
          </div>
        </div>
      `).join('');
      
      // ThÃªm nÃºt Load More náº¿u cÃ²n games chÆ°a hiá»ƒn thá»‹
      if (gamesToShow.length < gamesData.length) {
        const remaining = gamesData.length - gamesToShow.length;
        html += `
          <div class="load-more-container">
            <button class="load-more-btn" onclick="loadMoreGames()">
              ğŸ“± Xem thÃªm ${Math.min(gamesPerPage, remaining)} games ná»¯a
            </button>
            <p class="games-count">Äang hiá»ƒn thá»‹ ${gamesToShow.length} / ${gamesData.length} games</p>
          </div>
        `;
      }
      
      container.innerHTML = html;
    }

    function loadMoreGames() {
      currentPage++;
      renderGames();
      
      // Scroll xuá»‘ng má»™t chÃºt Ä‘á»ƒ tháº¥y games má»›i
      setTimeout(() => {
        window.scrollBy({ top: 200, behavior: 'smooth' });
      }, 100);
    }

    // ==========================================
    // GAME SEARCH FUNCTIONALITY
    // ==========================================
    const searchInput = document.getElementById('game-search');
    const searchResults = document.getElementById('search-results');
    
    if (searchInput && searchResults) {
      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim().toLowerCase();
        
        if (query.length < 2) {
          searchResults.classList.add('hidden');
          searchResults.innerHTML = '';
          return;
        }
        
        if (gamesData.length === 0) {
          searchResults.innerHTML = '<div class="search-no-results">ChÆ°a cÃ³ game nÃ o.</div>';
          searchResults.classList.remove('hidden');
          return;
        }
        
        const filtered = gamesData.filter(game => 
          game.name.toLowerCase().includes(query) ||
          game.description.toLowerCase().includes(query) ||
          game.category.toLowerCase().includes(query)
        );
        
        if (filtered.length > 0) {
          searchResults.innerHTML = filtered.map(game => `
            <a href="${game.testLink}" class="search-result-item" target="_blank">
              <img src="${game.icon}" alt="${game.name}" class="search-result-icon" />
              <div class="search-result-info">
                <div class="search-result-name">${game.name}</div>
                <div class="search-result-category">${game.category}</div>
              </div>
            </a>
          `).join('');
          searchResults.classList.remove('hidden');
        } else {
          searchResults.innerHTML = '<div class="search-no-results">KhÃ´ng tÃ¬m tháº¥y game</div>';
          searchResults.classList.remove('hidden');
        }
      });
      
      document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
          searchResults.classList.add('hidden');
        }
      });
      
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          searchInput.value = '';
          searchResults.classList.add('hidden');
        }
      });
    }
    
    // Load games khi trang load xong
    document.addEventListener('DOMContentLoaded', loadGames);
  </script>
</body>
</html>
